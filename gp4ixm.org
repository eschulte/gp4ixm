# -*- mode: org -*-
#+TITLE: Distributed GP for IXM
#+OPTIONS: num:nil ^:t toc:2
#+LaTeX_CLASS: normal

* Introduction

Implementing Genetic Programming (GP) in a distributed manner for a
group of IXM boards.

links
- [[http://harvey.cs.unm.edu/robust/doku.php?id=projects:distributed_ga_for_ixm][project wiki page]]
- [[http://github.com/eschulte/gp4ixm][github code page]]
- [[http://eschulte.github.com/gp4ixm/gp4ixm.html][github project page]]

* Instillation
use the following to grab a full copy of this repository
#+begin_src sh
  git clone git://github.com/eschulte/gp4ixm.git
  cd gp4ixm
  git submodule init
  git submodule update
#+end_src

* Components
** collector
  :PROPERTIES:
  :CUSTOM_ID: collector
  :END:
This functionality is now extracted into a separate file
=collector.cpp= which can be included into a sketch as demonstrated in
=collector/sketch.pde= in the repository.

It can be used to report integers, strings, or doubles to a laptop or
central collector attached to a group of IXM boards.  Along with the
value boards will report their location in terms of the path taken
from the central collector to get to the board.  For example of path
of "rflf" mean from the board immediately next to the laptop go...
- out the right (from the laptop)
- forward (straight through the board out the far face)
- left (from the entering face)
- forward

The boards need to be told where to report to before they will begin
their reports.  So to use this functionality you must first send a =c=
packet to your sketch containing an integer counter (boards will only
pay attention if the integer counter is greater than what they've
already seen).  So for example the following is the output of the
example sketch in =collector/sketch.pde=...

#+begin_example 
  c2                  # user input

  c45                 # output from first board (no path)
  c3.14
  cschulte
  c45 r               # output from board to the right of first board
  c3.14 r
  cschulte r
  c45
  c3.14
  cschulte
  c45 r
  c3.14 r
  cschulte r
#+end_example

** scrutinizer
  :PROPERTIES:
  :CUSTOM_ID: scrutinizer
  :END:
The scrutinizer is a ruby script which uses [[http://github.com/mixonic/libixm][libixm]] to monitor the
output of the [[collector]] sketch.  It uses the output of the collector
to maintain a collection of data structures representing the reporting
boards in the group.  Each board holds the following information
#+begin_src ruby
  # An ixm board with location and value
  class Board
    attr_accessor :location, :value, :cords
#+end_src
where =location= is the location of the board in terms of turns, as
reported form the ixms (e.g. "flrfflf"), =value= is a scalar value
reported by the board, and =cords= is the 2D coordinates of the board
with the laptop/usb-cord positioned at the origin.

The scrutinizer can generate 3D graphs of the data collected form the
boards using [[http://www.gnuplot.info/][gnuplot]].

*** usage
to run the scrutinizer
1) be sure that you have built the collector sketch
   #+begin_src sh
     cd collector
     make
   #+end_src
2) then run the scrutinizer
   #+begin_src sh
     ruby scrutinizer.rb
   #+end_src
   which should result in the following output to your terminal
   #+begin_example 
     initializing ixm connection
     creating board group
     telling boards I am here [24]
     got packet "c6 f"
     2
     Warning: empty x range [0:0], adjusting to [-1:1]
     got packet "c111 fl"
     4
     got packet "c81 fr"
     6
     got packet "c20 fll"
     6
     got packet "c16 f"
     6
     got packet "c94 fl"
     6
     ...
   #+end_example
   and which will also begin creating images in =/tmp/scrutinizer/=
3) to generate an animation of the images output by the scrutinizer
   try to following command (which uses [[http://www.imagemagick.org/script/index.php][imagemagick]])
   #+begin_src sh
     cd /tmp/scrutinizer
     convert -delay 20 -loop 1 group.*.png group.gif
   #+end_src
   the resulting =group.gif=, should look something like the following
   [[file:data/group.gif]]

** evaluator
  :PROPERTIES:
  :CUSTOM_ID: evaluator
  :END:
This sketch allows boards to evaluate strings of integers and
operators (=+=, =-=, =*=, =/=) on board using reverse polish notation.

* Issues / Notes
** new error code
after running multiple experiments with libixm, I've managed to
uncover a new error code...

: 1 red, 5 green, 6 blue

which means...

: /**< Failed to create an alarm when needed */

this should hopefully be fixed now...

** new segfaults...
this is the pre-fault output
#+begin_example 
  L 
  L 6 second on xxxx***
  L best fitness is 9965
  L mean fitness is 14188.25
  L best individual is 10 long and is 9x9+x92+**
  i 9x9+x9x99x*x*
  i 9x*x9+x+x92+**
  i 9x9+x*2++x*
  i 9x9+x9x99x*x*
  i 9x9x9+x*2++x*
  i 9x9+x9xx992+**
  L 
  L 7 second on xxxx***
  L best fitness is 2892
  L mean fitness is 12357.34
  L best individual is 13 long and is 9x7+x9x9*x*x*
  i 9x9x9+x*2++x*
  i 9x9+x9x99x9+x+x92+**
  i 9x9+x9x99x9+x+x92+**
  i 9x9x9+x+xx9*x*x*
  i 9x7+*9499**x*
  i 9x9+x9x99x98x*2++x9*x*x*L
  L 
  L 8 second on xxxx***
  L best fitness is 2892
  L mean fitness is 9667.04
  L best individual is 26 long and is 9x9+x9x99x9+x*2++x9*x*x*L
  i 9x9+x9x99x9+x*2++x9*x*x*L
  i 9x9+x9x99x9+x*2++x9*x*x*L
  i 9x9+x9x99x9+x*2++x9*x*x*L
  Ln Sun Nov  1 16:00:10 2009 [North baud rate set to 9600]
#+end_example

more careful maintenance of individuals seems to have fixed this issue

** size overflow
It looks like passing individuals by value rather than by reference is
overflowing the chips.  begin to change to passing by reference.

** hard goals

| goal               | best fitness | after      | meaning               |
|--------------------+--------------+------------+-----------------------|
| g 9x8x7x6x5**++*-* |          474 |            | x(x(30x + x + 7) - 8) |
| g 999xxx*****      |            0 | 19 seconds | 729x^3                |
|                    |              |            |                       |

** possibility of over-clocking the ixm w/alarms
this is currently handled by checking before every alarm is set and
when trying to set an alarm in the past, it instead sets it for a
second in the future.

currently this only happens when a new goal is being processed (which
makes sense, because that triggers a re-evaluation of every individual
in the population)
  
** DONE segfault (possibly crossover)

problem is in segfault, but it may not be noticed unless there are
large goals

we're copying past the end of our strings...

checking for end-of-string characters seems to help.

*** initial
at commit 36b2f62205e6b1564987d819aee282319664543a

still segfaulting, but seems to be caused by large goals, as show in
this example output
#+begin_example 
34 second on xxxx***
best fitness is 0
mean fitness is 153.19
best individual is 14 long and is 8+**8xx*x1/x**
g 9x8x7x6x5**++*-*
new goal is 9x8x7x6x5**++*-*
 
1 second on 9x8x7x6x5**++*-*
best fitness is 64410
mean fitness is 74313.37
best individual is 14 long and is 81**8xx*-1/x**
 
2 second on 9x8x7x6x5**++*-*
best fitness is 64125
mean fitness is 64353.00
best individual is 8 long and is xx*-1/1*
 
3 second on 9x8x7x6x5**++*-*
best fitness is 61966
mean fitness is 64070.36
best individual is 17 long and is 311*88**8-x*-1/1*
 
4 second on 9x8x7x6x5**++*-*
best fitness is 61641
mean fitness is 63532.51
best individual is 17 long and is 811*8-23xx8*-1/9*
 
5 second on 9x8x7x6x5**++*-*
best fitness is 47562
mean fitness is 61740.08
best individual is 17 long and is 311788**8-x*-1/1*
 
6 second on 9x8x7x6x5**++*-*
best fitness is 41028
mean fitness is 57034.68
best individual is 17 long and is 315788**8-x*-1/5*
 
7 second on 9x8x7x6x5**++*-*
Ln Mon Oct 26 18:02:06 2009 [North baud rate set to 9600]
  C-c C-c%                                                                                                          
$
#+end_example

*** does it segfault w/crossover commented out?
It seems that with crossover commented out, there is no possibility of
segfault.

* Experiments
** first set
solving x^3 with a variety of different GP parameters

* COMMENT publishing
#+begin_src emacs-lisp :results silent
  (setq gp4ixm-dir (file-name-directory (or load-file-name buffer-file-name)))
  (unless (boundp 'org-publish-project-alist)
    (setq org-publish-project-alist nil))
  (add-to-list 'org-publish-project-alist
               `("gp4ixm-html"
                  :base-directory ,gp4ixm-dir
                  :base-extension "org"
                  ;; :publishing-directory "www"
                  :publishing-directory "doc"
                  :index-filename "gp4ixm.org"
                  :auto-postamble nil
                  :postamble
                  "<div class=\"clear-fix\"></div>
  <div id=\"doc-info\">
    This document is created
    using <a href=\"http://orgmode.org/\">Org-mode</a>
    and <a href=\"http://orgmode.org/worg/org-contrib/babel/org-babel.php\">Org-babel</a>.
    The original plain-text document is available
    at <a href=\"gp4ixm.org\">gp4ixm.org</a>
    (<a href=\"gp4ixm.org.html\" title=\"how this document looks from inside Emacs\">preview</a>).
  </div>"
                  :publishing-function (org-publish-org-to-html org-publish-org-to-org)
                  :plain-source t
                  :htmlized-source t))
  (add-to-list 'org-publish-project-alist
               `("gp4ixm-data"
                 :base-directory ,(expand-file-name "data" gp4ixm-dir)
                 :base-extension "jpg\\|gif\\|png\\|pdf\\|css"
                  :publishing-directory "doc/data"
                  :publishing-function org-publish-attachment))
  (add-to-list 'org-publish-project-alist
               '("gp4ixm" :components
                 ("gp4ixm-html" "gp4ixm-data")))
#+end_src
